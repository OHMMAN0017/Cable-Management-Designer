<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPU Cable Calc Pro V2.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* (Style คงเดิมจากของเดิม แต่ปรับสีสถานะให้ชัดเจนขึ้น) */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --spu: #e70274; --spu-dark: #b8005c; --spu-light: #ff5e9e; --spu-pale: #fff0f7;
            --ink: #1a0a12; --ink-soft: #6b4a5a; --surface: #fffafb; --card: #ffffff;
            --border: rgba(231, 2, 116, 0.08); --shadow: 0 8px 32px -8px rgba(231, 2, 116, 0.18); --radius: 1.25rem;
        }
        body { font-family: 'Kanit', sans-serif; background: var(--surface); color: var(--ink); min-height: 100vh; position: relative; }
        .header { background: rgba(255, 255, 255, 0.8); border-bottom: 1px solid var(--border); padding: 0 1.5rem; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(12px); }
        .header-inner { max-width: 480px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 60px; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-badge { width: 36px; height: 36px; background: linear-gradient(135deg, var(--spu) 0%, var(--spu-light) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-family: 'Space Mono', monospace; font-size: 11px; color: white; font-weight: 700; }
        .logo-text strong { display: block; font-size: 12px; color: var(--spu); font-weight: 700; }
        .logo-text span { font-size: 9px; color: var(--ink-soft); font-weight: 300; }
        .main { max-width: 480px; margin: 0 auto; padding: 1.5rem 1.25rem 7rem; }
        .card { background: var(--card); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); overflow: hidden; padding: 1.5rem; margin-bottom: 1rem; }
        .lbl { display: block; font-size: 10px; font-weight: 600; color: var(--ink-soft); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 0.5rem; }
        .input-wrap select, .input-wrap input { width: 100%; background: #fafafa; border: 1.5px solid rgba(0,0,0,0.06); border-radius: 0.875rem; padding: 0.875rem; font-family: 'Kanit', sans-serif; font-size: 0.95rem; outline: none; }
        .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-top: 1rem; }
        .radio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; margin-top: 0.5rem; }
        .radio-option input { display: none; }
        .radio-face { display: flex; align-items: center; justify-content: center; padding: 0.75rem; border-radius: 0.875rem; border: 1.5px solid rgba(0,0,0,0.07); background: #fafafa; font-size: 0.85rem; cursor: pointer; }
        .radio-option input:checked + .radio-face { border-color: var(--spu); background: var(--spu-pale); color: var(--spu); }
        .btn-calc { width: 100%; background: linear-gradient(135deg, var(--spu) 0%, var(--spu-light) 100%); color: white; border: none; border-radius: 1rem; padding: 1rem; font-weight: 600; margin-top: 1.5rem; box-shadow: 0 6px 20px -4px rgba(231,2,116,0.45); }
        .result-hero { background: linear-gradient(135deg, var(--spu) 0%, #ff4d9b 100%); border-radius: var(--radius); padding: 1.5rem; color: white; margin-top: 1rem; display: none; }
        .result-hero.show { display: block; }
        .size-chips { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; }
        .size-chip { padding: 0.5rem 0.8rem; border-radius: 0.75rem; border: 1.5px solid var(--border); background: white; font-size: 0.8rem; }
        .size-chip.recommended { border-color: var(--spu); background: var(--spu-pale); color: var(--spu); font-weight: bold; }
        .status-pill { padding: 2px 8px; border-radius: 99px; font-size: 10px; }
        .status-ok { background: #d1fae5; color: #065f46; }
        .status-tight { background: #fee2e2; color: #991b1b; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 200; align-items: flex-end; }
        .modal-overlay.open { display: flex; }
        .modal-sheet { width: 100%; max-width: 480px; margin: 0 auto; background: white; border-radius: 1.75rem 1.75rem 0 0; padding: 1.5rem; }
        .compare-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.85rem; }
        .compare-table th, .compare-table td { padding: 0.8rem; border-bottom: 1px solid #eee; text-align: left; }
    </style>
</head>
<body>

<header class="header">
    <div class="header-inner">
        <div class="logo">
            <div class="logo-badge">SPU</div>
            <div class="logo-text"><strong>Cable Calc Pro</strong><span>Faculty of Engineering</span></div>
        </div>
        <div class="version-badge" style="background:var(--spu-pale); font-size:10px; padding:2px 8px; border-radius:10px; color:var(--spu)">V2.1</div>
    </div>
</header>

<main class="main">
    <div class="card">
        <label class="lbl">ประเภทสายไฟฟ้า</label>
        <div class="input-wrap">
            <select id="cableType" onchange="updateSizes()">
                <option value="iec01">IEC 01 (THW)</option>
                <option value="nyy1c">NYY 1/C</option>
                <option value="xlpe1c">XLPE 1/C</option>
            </select>
        </div>

        <div class="grid2">
            <div>
                <label class="lbl">ขนาดสาย (mm²)</label>
                <select id="cableSize" class="input-wrap" style="width:100%; padding:0.8rem; border-radius:0.8rem; border:1.5px solid #eee"></select>
            </div>
            <div>
                <label class="lbl">จำนวน (เส้น)</label>
                <input type="number" id="cableQty" value="3" min="1" class="input-wrap" style="width:100%; padding:0.8rem; border-radius:0.8rem; border:1.5px solid #eee">
            </div>
        </div>

        <div style="margin-top:1.5rem">
            <label class="lbl">ระบบการติดตั้ง</label>
            <div class="radio-grid">
                <label class="radio-option">
                    <input type="radio" name="installType" value="conduit" checked>
                    <div class="radio-face">ท่อร้อยสาย (Conduit)</div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="installType" value="wireway">
                    <div class="radio-face">รางเดินสาย (Wireway)</div>
                </label>
            </div>
        </div>

        <button class="btn-calc" onclick="calculate()">คำนวณตามมาตรฐาน วสท.</button>
    </div>

    <div id="resultArea" class="result-hero">
        <div style="font-size:10px; opacity:0.8">แนะนำขนาดที่เหมาะสม</div>
        <div id="recSize" style="font-size:2rem; font-weight:700">—</div>
        <div id="recSub" style="font-size:0.85rem; margin-top:0.5rem"></div>
        <div style="margin-top:1rem; height:6px; background:rgba(255,255,255,0.2); border-radius:10px">
            <div id="fillBar" style="height:100%; background:white; border-radius:10px; width:0%; transition:0.5s"></div>
        </div>
        <div id="fillLabel" style="font-size:10px; margin-top:5px; text-align:right">0%</div>
    </div>

    <div id="chipContainer" style="display:none; margin-top:1rem" class="card">
        <label class="lbl">ขนาดอื่นๆ เพื่อเปรียบเทียบ</label>
        <div id="sizeChips" class="size-chips"></div>
    </div>
</main>

<div class="modal-overlay" id="compareModal" onclick="closeModal(event)">
    <div class="modal-sheet">
        <h3 id="modalTitle">รายละเอียดการคำนวณ</h3>
        <p id="modalSub" style="font-size:0.8rem; color:var(--ink-soft); margin-bottom:1rem"></p>
        <table class="compare-table">
            <thead><tr><th>ขนาด</th><th>ใช้งานจริง</th><th>สถานะ</th></tr></thead>
            <tbody id="compareBody"></tbody>
        </table>
        <div style="margin-top:1rem; font-size:0.75rem; color:var(--spu); background:var(--spu-pale); padding:10px; border-radius:10px">
            * เกณฑ์สูงสุด: 1 เส้น=53%, 2 เส้น=31%, 3+ เส้น=40% (ท่อ) / 20% (ราง)
        </div>
    </div>
</div>

<script>
    const cableData = {
        iec01:  { "1.5":8.5, "2.5":12.5, "4":16.6, "6":21.2, "10":35.2, "16":47.7, "25":73.8, "35":93.9, "50":129, "70":167, "95":230, "120":278, "150":343 },
        nyy1c:  { "1":60.8, "1.5":66.5, "2.5":75.4, "4":86.6, "6":95, "10":113, "16":133, "25":165, "35":201, "50":227, "70":284, "95":363, "120":416 },
        xlpe1c: { "1.5":33.1, "2.5":38.4, "4":44.1, "6":50.2, "10":56.7, "16":70.8, "25":104, "35":123, "50":154, "70":189, "95":241 }
    };

    // Conduit Area (Area หน้าตัดท่อเต็ม 100%)
    const conduitData = [ 
        {name:'1/2"', area:191}, {name:'3/4"', area:314}, {name:'1"', area:491}, 
        {name:'1¼"', area:804}, {name:'1½"', area:1257}, {name:'2"', area:1963}, 
        {name:'2½"', area:3318}, {name:'3"', area:5027} 
    ];

    // Wireway (กว้าง x สูง = Area เต็ม 100%)
    const wirewayData = [ 
        {name:"50×75", w:50, h:75}, {name:"50×100", w:50, h:100}, 
        {name:"75×100", w:75, h:100}, {name:"100×100", w:100, h:100}, 
        {name:"100×150", w:100, h:150}, {name:"150×150", w:150, h:150} 
    ].map(item => ({...item, area: item.w * item.h}));

    function updateSizes() {
        const type = document.getElementById('cableType').value;
        const sel = document.getElementById('cableSize'); sel.innerHTML = '';
        Object.keys(cableData[type]).forEach(s => sel.add(new Option(s, s)));
    }
    updateSizes();

    let lastCalc = null;

    function calculate() {
        const type = document.getElementById('cableType').value;
        const size = document.getElementById('cableSize').value;
        const qty = parseInt(document.getElementById('cableQty').value) || 1;
        const install = document.querySelector('input[name="installType"]:checked').value;

        // พื้นที่หน้าตัดสายไฟรวม
        const totalCableArea = cableData[type][size] * qty;
        
        // กำหนด Fill Factor ตามจำนวนเส้น (มาตรฐาน วสท.)
        let maxLimit;
        if (install === 'conduit') {
            if (qty === 1) maxLimit = 0.53;
            else if (qty === 2) maxLimit = 0.31;
            else maxLimit = 0.40;
        } else {
            // รางเดินสาย ปกติคิดที่ 20% (เว้นแต่สายเส้นเดียวขนาดใหญ่พิเศษ แต่ทั่วไปใช้เกณฑ์ 20%)
            maxLimit = 0.20;
            if (qty === 1) maxLimit = 0.53; // กรณีเส้นเดียว
        }

        const dataset = install === 'conduit' ? conduitData : wirewayData;

        const allOptions = dataset.map(item => {
            const usedPct = (totalCableArea / item.area) * 100;
            return {
                ...item,
                usedPct: usedPct.toFixed(1),
                limit: (maxLimit * 100).toFixed(0),
                fits: (totalCableArea / item.area) <= maxLimit
            };
        });

        const recommended = allOptions.find(o => o.fits) || allOptions[allOptions.length-1];

        lastCalc = { totalCableArea, qty, install, allOptions, recommended, maxLimit };
        
        // Render
        document.getElementById('resultArea').classList.add('show');
        document.getElementById('chipContainer').style.display = 'block';
        document.getElementById('recSize').textContent = (install === 'conduit' ? 'ท่อ ' : 'ราง ') + recommended.name;
        document.getElementById('recSub').innerHTML = `พื้นที่สายรวม: ${totalCableArea.toFixed(1)} mm²<br>ใช้ไป ${recommended.usedPct}% (เกณฑ์สูงสุด ${maxLimit*100}%)`;
        document.getElementById('fillBar').style.width = Math.min((recommended.usedPct / (maxLimit*100)) * 100, 100) + '%';
        document.getElementById('fillLabel').textContent = recommended.usedPct + '%';

        const chips = document.getElementById('sizeChips');
        chips.innerHTML = '';
        allOptions.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'size-chip' + (opt === recommended ? ' recommended' : '');
            btn.textContent = opt.name;
            btn.onclick = () => showDetail(idx);
            chips.appendChild(btn);
        });
    }

    function showDetail(idx) {
        const c = lastCalc;
        const opt = c.allOptions[idx];
        document.getElementById('modalSub').textContent = `พื้นที่สายไฟ ${c.totalCableArea.toFixed(1)} mm² / พื้นที่หน้าตัดอุปกรณ์เต็ม ${opt.area} mm²`;
        
        const tbody = document.getElementById('compareBody');
        tbody.innerHTML = c.allOptions.map(o => `
            <tr style="${o === opt ? 'background:var(--spu-pale)' : ''}">
                <td>${o.name}</td>
                <td>${o.usedPct}%</td>
                <td><span class="status-pill ${o.fits ? 'status-ok' : 'status-tight'}">${o.fits ? 'ผ่าน' : 'ไม่ผ่าน'}</span></td>
            </tr>
        `).join('');
        document.getElementById('compareModal').classList.add('open');
    }

    function closeModal(e) { if(e.target.id === 'compareModal') e.target.classList.remove('open'); }
</script>
</body>
</html>
