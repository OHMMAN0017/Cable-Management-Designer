<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPU Cable Calc Pro — Electrical Engineering Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --spu: #e70274;
            --spu-dark: #b8005c;
            --spu-light: #ff5e9e;
            --spu-pale: #fff0f7;
            --spu-glass: rgba(231, 2, 116, 0.08);
            --ink: #1a0a12;
            --ink-soft: #6b4a5a;
            --surface: #fffafb;
            --card: #ffffff;
            --border: rgba(231, 2, 116, 0.08);
            --shadow: 0 8px 32px -8px rgba(231, 2, 116, 0.18);
            --radius: 1.25rem;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: var(--surface);
            color: var(--ink);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            position: relative;
        }

        /* ซ่อมแซม Background Grain */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid var(--border);
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }
        .header-inner {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-badge {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--spu) 0%, var(--spu-light) 100%);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Space Mono', monospace; font-size: 11px; color: white; font-weight: 700;
        }
        .logo-text strong { display: block; font-size: 12px; color: var(--spu); font-weight: 700; }
        .logo-text span { font-size: 9px; color: var(--ink-soft); font-weight: 300; }
        .version-badge {
            font-family: 'Space Mono', monospace; font-size: 10px; color: var(--spu);
            background: var(--spu-pale); padding: 3px 8px; border-radius: 20px; border: 1px solid rgba(231,2,116,0.15);
        }

        /* Layout & Cards */
        .main { max-width: 480px; margin: 0 auto; padding: 1.5rem 1.25rem 7rem; position: relative; z-index: 1; }
        .hero { text-align: center; padding: 1.75rem 0 1.25rem; }
        .hero h1 { font-size: 1.6rem; font-weight: 700; line-height: 1.2; }
        .hero h1 span { color: var(--spu); }
        .hero p { color: var(--ink-soft); font-size: 0.82rem; margin-top: 0.35rem; }

        .card { background: var(--card); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); overflow: hidden; }
        .form-card { padding: 1.5rem; margin-bottom: 1rem; }

        /* Inputs */
        .lbl { display: block; font-size: 10px; font-weight: 600; color: var(--ink-soft); letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 0.5rem; }
        .input-wrap { position: relative; }
        .input-wrap select, .input-wrap input {
            width: 100%; background: #fafafa; border: 1.5px solid rgba(0,0,0,0.06);
            border-radius: 0.875rem; padding: 0.875rem 1rem; font-family: 'Kanit', sans-serif;
            font-size: 0.95rem; outline: none; transition: all 0.2s; appearance: none;
        }
        .input-wrap select:focus, .input-wrap input:focus { border-color: var(--spu); background: white; box-shadow: 0 0 0 3px rgba(231,2,116,0.1); }
        .input-icon { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: var(--ink-soft); pointer-events: none; opacity: 0.5; }

        .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .radio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }
        .radio-option input { display: none; }
        .radio-face {
            display: flex; align-items: center; justify-content: center; gap: 7px; padding: 0.75rem 0.5rem;
            border-radius: 0.875rem; border: 1.5px solid rgba(0,0,0,0.07); background: #fafafa;
            font-size: 0.85rem; cursor: pointer; transition: all 0.2s;
        }
        .radio-option input:checked + .radio-face { border-color: var(--spu); background: var(--spu-pale); color: var(--spu); box-shadow: 0 0 0 1px var(--spu); }

        .btn-calc {
            width: 100%; background: linear-gradient(135deg, var(--spu) 0%, var(--spu-light) 100%);
            color: white; border: none; border-radius: 1rem; padding: 1rem; font-family: 'Kanit', sans-serif;
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.15s;
            box-shadow: 0 6px 20px -4px rgba(231,2,116,0.45); display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-calc:active { transform: scale(0.97); }

        /* Results Area */
        #resultArea { display: none; margin-top: 1rem; }
        #resultArea.show { display: block; animation: slideUp 0.45s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-hero {
            background: linear-gradient(135deg, var(--spu) 0%, #ff4d9b 100%);
            border-radius: var(--radius); padding: 1.5rem; color: white; position: relative; margin-bottom: 0.75rem;
        }
        .result-value { font-size: 2rem; font-weight: 700; line-height: 1.1; margin: 0.2rem 0; }
        .result-fill-bar { margin-top: 1rem; background: rgba(255,255,255,0.2); border-radius: 99px; height: 6px; }
        .result-fill-inner { height: 100%; border-radius: 99px; background: white; width: 0%; transition: width 0.8s ease; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem; }
        .stat-card { background: white; border-radius: var(--radius); border: 1px solid var(--border); padding: 1rem; text-align: center; }
        .stat-val { font-size: 1.15rem; font-weight: 700; }
        .stat-val.ok { color: #10b981; }
        .stat-val.warn { color: #f59e0b; }

        .size-chips { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
        .size-chip {
            padding: 0.5rem 0.85rem; border-radius: 0.75rem; border: 1.5px solid var(--border);
            background: white; font-family: 'Space Mono', monospace; font-size: 0.82rem; cursor: pointer;
        }
        .size-chip.recommended { border-color: var(--spu); background: var(--spu-pale); color: var(--spu); }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px); z-index: 200; align-items: flex-end;
        }
        .modal-overlay.open { display: flex; }
        .modal-sheet {
            width: 100%; max-width: 480px; margin: 0 auto; background: white;
            border-radius: 1.75rem 1.75rem 0 0; max-height: 85vh; overflow-y: auto;
        }
        .modal-body { padding: 1.5rem; }
        .compare-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .compare-table td, .compare-table th { padding: 0.75rem; border-bottom: 1px solid #eee; text-align: left; font-size: 0.85rem; }

        /* Footer */
        .footer-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border); z-index: 99;
        }
        .footer-inner { max-width: 480px; margin: 0 auto; padding: 0.75rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        
        .info-note { display: flex; gap: 8px; background: var(--spu-glass); padding: 1rem; border-radius: 1rem; margin-top: 1rem; font-size: 0.8rem; }
        .status-pill { padding: 2px 8px; border-radius: 99px; font-size: 10px; font-weight: 600; }
        .status-ok { background: #d1fae5; color: #065f46; }
        .status-tight { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

<header class="header">
    <div class="header-inner">
        <div class="logo">
            <div class="logo-badge">SPU</div>
            <div class="logo-text"><strong>Cable Calc Pro</strong><span>Faculty of Engineering</span></div>
        </div>
        <div class="version-badge">v2.0</div>
    </div>
</header>

<main class="main">
    <div class="hero">
        <h1>คำนวณ<span>สาย&ท่อ</span>ไฟฟ้า</h1>
        <p>อ้างอิง IEC 60364 · มาตรฐาน กฟน./กฟภ. · วสท.</p>
    </div>

    <div class="card form-card">
        <div style="margin-bottom:1.1rem">
            <label class="lbl">ประเภทสายไฟฟ้า</label>
            <div class="input-wrap">
                <select id="cableType" onchange="updateSizes()">
                    <option value="iec01">IEC 01 (THW) — เดี่ยวฉนวน PVC</option>
                    <option value="nyy1c">NYY 1/C — เปลือก PVC ชั้นเดียว</option>
                    <option value="xlpe1c">XLPE 1/C — ฉนวน XLPE</option>
                </select>
                <span class="input-icon">▼</span>
            </div>
        </div>

        <div class="grid2" style="margin-bottom:1.1rem">
            <div>
                <label class="lbl">ขนาดสาย (mm²)</label>
                <div class="input-wrap">
                    <select id="cableSize"></select>
                </div>
            </div>
            <div>
                <label class="lbl">จำนวน (เส้น)</label>
                <div class="input-wrap">
                    <input type="number" id="cableQty" value="3" min="1">
                </div>
            </div>
        </div>

        <div style="margin-bottom:1.25rem">
            <label class="lbl" style="text-align:center">ระบบการติดตั้ง</label>
            <div class="radio-grid">
                <label class="radio-option">
                    <input type="radio" name="installType" value="conduit" checked>
                    <div class="radio-face">ท่อร้อยสาย</div>
                </label>
                <label class="radio-option">
                    <input type="radio" name="installType" value="wireway">
                    <div class="radio-face">รางเดินสาย</div>
                </label>
            </div>
        </div>

        <button class="btn-calc" onclick="calculate()">คำนวณขนาดท่อ / ราง</button>
    </div>

    <div id="resultArea">
        <div class="result-hero">
            <div style="font-size:10px; opacity:0.8">ขนาดแนะนำ</div>
            <div class="result-value" id="recSize">—</div>
            <div id="recSub" style="font-size:0.8rem; opacity:0.9">—</div>
            <div class="result-fill-bar"><div class="result-fill-inner" id="fillBar"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:10px; margin-top:5px">
                <span>พื้นที่ใช้งาน</span><span id="fillPct">0%</span>
            </div>
        </div>

        <div class="stat-grid">
            <div class="stat-card">
                <div class="lbl">พื้นที่สายรวม</div>
                <div class="stat-val" id="totalArea">—</div>
            </div>
            <div class="stat-card">
                <div class="lbl">พื้นที่ว่างคงเหลือ</div>
                <div class="stat-val" id="remainPct">—</div>
            </div>
        </div>

        <div class="card" style="padding:1.25rem">
            <div class="lbl">เปรียบเทียบขนาดอื่นๆ</div>
            <div class="size-chips" id="sizeChips"></div>
        </div>
    </div>
</main>

<footer class="footer-bar">
    <div class="footer-inner">
        <div class="logo">
            <div class="logo-badge" style="width:30px; height:30px">SPU</div>
            <div class="logo-text"><strong>Sripatum</strong><span>Engineering</span></div>
        </div>
        <div style="font-size:9px; text-align:right; color:var(--ink-soft)">
            IEC 60364 / วสท.<br>Standard Compliant
        </div>
    </div>
</footer>

<div class="modal-overlay" id="compareModal" onclick="closeModal(event)">
    <div class="modal-sheet">
        <div style="width:40px; height:4px; background:#ddd; margin:10px auto; border-radius:2px"></div>
        <div class="modal-body">
            <h3 id="modalTitle">รายละเอียด</h3>
            <p id="modalSub" style="font-size:0.8rem; color:var(--ink-soft)"></p>
            <table class="compare-table">
                <thead><tr><th>ขนาด</th><th>ใช้ไป</th><th>สถานะ</th></tr></thead>
                <tbody id="compareBody"></tbody>
            </table>
            <div id="modalDetail" class="info-note"></div>
        </div>
    </div>
</div>

<script>
    const cableData = {
        iec01:  { "1.5":8.5, "2.5":12.5, "4":16.6, "6":21.2, "10":35.2, "16":47.7, "25":73.8, "35":93.9, "50":129, "70":167, "95":230, "120":278, "150":343 },
        nyy1c:  { "1":60.8, "1.5":66.5, "2.5":75.4, "4":86.6, "6":95, "10":113, "16":133, "25":165, "35":201, "50":227, "70":284, "95":363, "120":416 },
        xlpe1c: { "1.5":33.1, "2.5":38.4, "4":44.1, "6":50.2, "10":56.7, "16":70.8, "25":104, "35":123, "50":154, "70":189, "95":241 }
    };

    const conduitData = [ {name:'1/2"', area:71}, {name:'3/4"', area:126}, {name:'1"', area:196}, {name:'1¼"', area:322}, {name:'1½"', area:503}, {name:'2"', area:785}, {name:'2½"', area:1327}, {name:'3"', area:2011} ];
    const wirewayData = [ {name:"50×75", area:750}, {name:"50×100", area:1000}, {name:"75×100", area:1500}, {name:"100×100", area:2000}, {name:"100×150", area:3000}, {name:"150×150", area:4500} ];

    function updateSizes() {
        const type = document.getElementById('cableType').value;
        const sel = document.getElementById('cableSize');
        sel.innerHTML = '';
        Object.keys(cableData[type]).forEach(s => {
            let opt = new Option(s, s);
            sel.add(opt);
        });
    }
    updateSizes();

    let lastCalc = null;

    function calculate() {
        const type = document.getElementById('cableType').value;
        const size = document.getElementById('cableSize').value;
        const qty = parseInt(document.getElementById('cableQty').value) || 1;
        const install = document.querySelector('input[name="installType"]:checked').value;

        const unitArea = cableData[type][size];
        const totalCable = unitArea * qty;
        const limit = install === 'conduit' ? 0.40 : 0.20;
        const dataset = install === 'conduit' ? conduitData : wirewayData;

        const allOptions = dataset.map(item => {
            const usedPct = (totalCable / item.area) * 100;
            return { ...item, usedPct: usedPct.toFixed(1), fits: (totalCable / item.area) <= limit };
        });

        const recommended = allOptions.find(o => o.fits) || allOptions[allOptions.length-1];
        
        lastCalc = { type, size, qty, install, totalCable, limit, allOptions, recommended };
        renderResult();
    }

    function renderResult() {
        const c = lastCalc;
        document.getElementById('resultArea').classList.add('show');
        document.getElementById('recSize').textContent = (c.install === 'conduit' ? 'ท่อ ' : 'ราง ') + c.recommended.name;
        document.getElementById('recSub').textContent = `พื้นที่ใช้งาน ${c.recommended.usedPct}% (มาตรฐานไม่เกิน ${c.limit*100}%)`;
        document.getElementById('fillBar').style.width = Math.min(c.recommended.usedPct, 100) + '%';
        document.getElementById('fillPct').textContent = c.recommended.usedPct + '%';
        document.getElementById('totalArea').textContent = c.totalCable.toFixed(1) + ' mm²';
        document.getElementById('remainPct').textContent = (100 - c.recommended.usedPct).toFixed(1) + '%';

        const chips = document.getElementById('sizeChips');
        chips.innerHTML = '';
        c.allOptions.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'size-chip' + (opt === c.recommended ? ' recommended' : '');
            btn.textContent = opt.name;
            btn.onclick = () => openModal(idx);
            chips.appendChild(btn);
        });
    }

    function openModal(idx) {
        const c = lastCalc;
        const opt = c.allOptions[idx];
        document.getElementById('modalTitle').textContent = 'ขนาด ' + opt.name;
        document.getElementById('modalSub').textContent = `สาย ${c.size} mm² จำนวน ${c.qty} เส้น`;
        
        const tbody = document.getElementById('compareBody');
        tbody.innerHTML = c.allOptions.map(o => `
            <tr style="${o === opt ? 'background:#fff0f7' : ''}">
                <td>${o.name}</td>
                <td>${o.usedPct}%</td>
                <td><span class="status-pill ${o.fits ? 'status-ok' : 'status-tight'}">${o.fits ? 'ผ่าน' : 'เกิน'}</span></td>
            </tr>
        `).join('');

        document.getElementById('modalDetail').innerHTML = `พื้นที่สายรวม: ${c.totalCable.toFixed(2)} mm² <br> พื้นที่อุปกรณ์: ${opt.area} mm²`;
        document.getElementById('compareModal').classList.add('open');
    }

    function closeModal(e) {
        if (e.target.id === 'compareModal') {
            document.getElementById('compareModal').classList.remove('open');
        }
    }
</script>

</body>
</html>
